<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eric Shearer, MPH, REHS / eshearer@ochca.com">
<meta name="dcterms.date" content="2024-10-16">

<title>Building an Internal R Package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: #FFFFFF;
      }

      .quarto-title-block .quarto-title-banner {
        color: #FFFFFF;
background: #353D42;
      }
</style>


</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Building an Internal R Package</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Eric Shearer, MPH, REHS / eshearer@ochca.com </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 16, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-build-a-package" id="toc-why-build-a-package" class="nav-link active" data-scroll-target="#why-build-a-package">Why build a package?</a>
  <ul class="collapse">
  <li><a href="#benefits" id="toc-benefits" class="nav-link" data-scroll-target="#benefits">Benefits</a></li>
  <li><a href="#challenges" id="toc-challenges" class="nav-link" data-scroll-target="#challenges">Challenges</a></li>
  </ul></li>
  <li><a href="#building-the-r-package" id="toc-building-the-r-package" class="nav-link" data-scroll-target="#building-the-r-package">Building the R package</a>
  <ul class="collapse">
  <li><a href="#tools" id="toc-tools" class="nav-link" data-scroll-target="#tools">Tools</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul></li>
  <li><a href="#package-overview" id="toc-package-overview" class="nav-link" data-scroll-target="#package-overview">Package overview</a>
  <ul class="collapse">
  <li><a href="#example-use-case" id="toc-example-use-case" class="nav-link" data-scroll-target="#example-use-case">Example Use Case</a></li>
  <li><a href="#honorable-mentions" id="toc-honorable-mentions" class="nav-link" data-scroll-target="#honorable-mentions">Honorable Mentions</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<style>
.narrow {
    width: 85% !important;
}
</style>
<section id="why-build-a-package" class="level1">
<h1>Why build a package?</h1>
<blockquote class="blockquote">
<p>” The concept is that anytime anyone on the team solves a problem that they think others might encounter, they can generalize their code, include it into Rbnb and now the whole team can access it.” - How R Helps Airbnb Make the Most of Its Data (<a href="https://peerj.com/preprints/3182.pdf">PDF link</a>)</p>
</blockquote>
<blockquote class="blockquote">
<p>“We build packages to develop collaborative solutions to common problems, to standardize the visual presentation of our work, and to avoid reinventing the wheel.” - Using R packages and education to scale Data Science at Airbnb (<a href="https://medium.com/airbnb-engineering/using-r-packages-and-education-to-scale-data-science-at-airbnb-906faa58e12d">link</a>)</p>
</blockquote>
<p>Examples of “common problems” in our day to day work:</p>
<ul>
<li>Recoding demographics (e.g.&nbsp;age groups, race/ethnicity)</li>
<li>Standardizing addresses prior to geocoding</li>
<li>Making unique id’s to link two datasets together</li>
<li>Suppressing or removing sensitive data before publishing</li>
<li>Making epidemic curves/maps/other data visualizations</li>
<li>Converting dates to higher levels for aggregating (e.g.&nbsp;mmwr week or year, week ending date)</li>
</ul>
<section id="benefits" class="level3">
<h3 class="anchored" data-anchor-id="benefits">Benefits</h3>
<ul>
<li>Eliminate copy &amp; pasting code from script to script to script to script to…</li>
<li>Standardization across data visualizations and data clean-up</li>
<li>Reduces barriers/time to completing more meaningful analysis</li>
</ul>
</section>
<section id="challenges" class="level3">
<h3 class="anchored" data-anchor-id="challenges">Challenges</h3>
<p>Building packages is rewarding but not without challenges:</p>
<ul>
<li>Ideas (existing vs.&nbsp;new)</li>
<li>ALL. THE. TESTING. (and documenting it)</li>
<li>Deployment/distribution</li>
</ul>
<hr>
</section>
</section>
<section id="building-the-r-package" class="level1">
<h1>Building the R package</h1>
<section id="tools" class="level3">
<h3 class="anchored" data-anchor-id="tools">Tools</h3>
<p><strong>usethis</strong> is a workflow package: sets up GitHub, pkgdown website, templating.</p>
<p><strong>testthat</strong> automates unit testing, which describes what you expect a function to do.</p>
<p><strong>roxygen2</strong> describes your functions in formal documentation.</p>
<p><strong>devtools</strong> builds the actual package, checks for unregistered dependencies, runs checks to ensure package can be ran on multiple systems (Windows, macOS, Ubuntu), and executes unit testing from testthat.</p>
</section>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<p>How do we decide what goes into the package? Using the example below, there are some obvious candidates we can generalize into functions: age, gender, sexual orientation, and race/ethnicity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>cases <span class="ot">&lt;-</span> udf <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RStatus <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Confirmed"</span>,<span class="st">"Probable"</span>,<span class="st">"Suspect"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pos_lab, <span class="at">by =</span> <span class="st">"IncidentID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"DtEpisode"</span>,<span class="st">"DtOnset"</span>,<span class="st">"DtLabCollect"</span>), <span class="sc">~</span> <span class="fu">as.Date</span>(., <span class="st">"%m/%d/%Y"</span>)),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">AgeGroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">%in%</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">~</span> <span class="st">"0-15"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">%in%</span> <span class="dv">16</span><span class="sc">:</span><span class="dv">24</span> <span class="sc">~</span> <span class="st">"16-24"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">%in%</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">34</span> <span class="sc">~</span> <span class="st">"25-34"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">%in%</span> <span class="dv">35</span><span class="sc">:</span><span class="dv">44</span> <span class="sc">~</span> <span class="st">"35-44"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">%in%</span> <span class="dv">45</span><span class="sc">:</span><span class="dv">54</span> <span class="sc">~</span> <span class="st">"45-54"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">%in%</span> <span class="dv">55</span><span class="sc">:</span><span class="dv">64</span> <span class="sc">~</span> <span class="st">"55-64"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">&gt;</span> <span class="dv">64</span> <span class="sc">~</span> <span class="st">"65+"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Gender =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      Gender <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">~</span> <span class="st">"Male"</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      Gender <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> <span class="st">"Female"</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      Gender <span class="sc">==</span> <span class="st">"TF"</span> <span class="sc">~</span> <span class="st">"Transgender woman"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      Gender <span class="sc">==</span> <span class="st">"TM"</span> <span class="sc">~</span> <span class="st">"Transgender man"</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      Gender <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"U"</span>,<span class="st">"D"</span>) <span class="sc">~</span> <span class="st">"Missing/Unknown"</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      Gender <span class="sc">==</span> <span class="st">"I"</span> <span class="sc">~</span> <span class="st">"Identity Not Listed"</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      Gender <span class="sc">==</span> <span class="st">"G"</span> <span class="sc">~</span> <span class="st">"Genderqueer/Non-binary"</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(Gender) <span class="sc">~</span> <span class="st">"Missing/Unknown"</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">CTCIAdtlDemOrient =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      CTCIAdtlDemOrient <span class="sc">==</span> <span class="st">"BIS"</span> <span class="sc">~</span> <span class="st">"Bisexual"</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      CTCIAdtlDemOrient <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DNK"</span>,<span class="st">"UNK"</span>,<span class="st">"NOT"</span>,<span class="st">"DEC"</span>) <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      CTCIAdtlDemOrient <span class="sc">==</span> <span class="st">"HET"</span> <span class="sc">~</span> <span class="st">"Heterosexual or straight"</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      CTCIAdtlDemOrient <span class="sc">==</span> <span class="st">"HOM"</span> <span class="sc">~</span> <span class="st">"Gay, lesbian, or same gender-loving"</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(CTCIAdtlDemOrient) <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> CTCIAdtlDemOrient),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">RaceEthnicity =</span> <span class="fu">ifelse</span>(Ethnicity <span class="sc">==</span> <span class="st">"Hispanic or Latino"</span>, Ethnicity, Race),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">RaceEthnicity =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      RaceEthnicity <span class="sc">==</span> <span class="st">"Hispanic or Latino"</span> <span class="sc">~</span> <span class="st">"Hispanic/Latinx"</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      RaceEthnicity <span class="sc">==</span> <span class="st">"Black or African American"</span> <span class="sc">~</span> <span class="st">"Black/African American"</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      RaceEthnicity <span class="sc">==</span> <span class="st">"Native Hawaiian or Other Pacific Islander"</span> <span class="sc">~</span> <span class="st">"NHOPI"</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      RaceEthnicity <span class="sc">==</span> <span class="st">"American Indian or Alaska Native"</span> <span class="sc">~</span> <span class="st">"AI/AN"</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> RaceEthnicity),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">CliTxOrthopoxTx =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      CliTxOrthopoxTx <span class="sc">==</span> <span class="st">"YT"</span> <span class="sc">~</span> <span class="st">"Tecovirimat"</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>      CliTxOrthopoxTx <span class="sc">==</span> <span class="st">"YO"</span> <span class="sc">~</span> <span class="st">"Yes, Not Specified"</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      CliTxOrthopoxTx <span class="sc">==</span> <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"None"</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      CliTxOrthopoxTx <span class="sc">==</span> <span class="st">"DK"</span> <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(CliTxOrthopoxTx) <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span>),</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">homeless =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>      EpiGrpSetLTExp_HML_1 <span class="sc">==</span> <span class="st">"HML"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      EpiGrpSetLTExp_HML_2 <span class="sc">==</span> <span class="st">"HML"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>      EpiGrpSetLTExp_HML_3 <span class="sc">==</span> <span class="st">"HML"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>      City <span class="sc">==</span> <span class="st">"Homeless"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>      Zip <span class="sc">==</span> <span class="st">"99999"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"N"</span>),</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">HOSPHOSPITALIZED =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>      HOSPHOSPITALIZED <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>      HOSPHOSPITALIZED <span class="sc">==</span> <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(HOSPHOSPITALIZED) <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span>),</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">monkeypox_pcr =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>      LabLRSSpecTstMeth_1_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> LabLRSSpecRslt_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>      LabLRSSpecTstMeth_1_2 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> LabLRSSpecRslt_2 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>      LabLRSSpecTstMeth_1_3 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> LabLRSSpecRslt_3 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>),</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">orthopox_pcr =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>      LabLRSSpecTstMeth_4_1 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> LabLRSSpecRslt_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>      LabLRSSpecTstMeth_5_1 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> LabLRSSpecRslt_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>      LabLRSSpecTstMeth_4_2 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> LabLRSSpecRslt_2 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>      LabLRSSpecTstMeth_5_2 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> LabLRSSpecRslt_2 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>),</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>      test_type <span class="sc">==</span> <span class="st">"Monkeypox PCR"</span> <span class="sc">~</span> <span class="st">"Confirmed"</span>, <span class="co">#elr</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>      monkeypox_pcr <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Confirmed"</span>, <span class="co">#manually entered</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>      test_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Non-variola Orthopox PCR"</span>,<span class="st">"Orthopoxvirus PCR"</span>) <span class="sc">~</span> <span class="st">"Probable"</span>, <span class="co">#elr</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>      orthopox_pcr <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Probable"</span>, <span class="co">#manually entered</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Suspect"</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Disease, IncidentID, <span class="at">Gender =</span> Sex, <span class="at">Public_Orientation =</span> CTCIAdtlDemOrient, Age, AgeGroup, RaceEthnicity, City, Zip, RStatus, case_type, Investigator,</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>         FinalDispo, DtEpisode, DtOnset, DtLabCollect, Gender_Partner, <span class="at">treatment =</span> CliTxOrthopoxTx, <span class="at">tx_type =</span> CliTxOrthopoxTxSpcfy, homeless, <span class="at">hospitalized =</span> HOSPHOSPITALIZED,</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">Outcome =</span> OUTCOMEOUTCOME, DtDeath, NOTES)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resources" class="level3">
<h3 class="anchored" data-anchor-id="resources">Resources</h3>
<ul>
<li><a href="https://r-pkgs.org/">R Packages (2e)</a></li>
<li><a href="https://happygitwithr.com/">Let’s Git started</a></li>
</ul>
<hr>
</section>
</section>
<section id="package-overview" class="level1">
<h1>Package overview</h1>
<div class="columns">
<div class="column" style="width:60%;">
<section id="specs" class="level3">
<h3 class="anchored" data-anchor-id="specs">Specs</h3>
<ul>
<li>Built for familiar data systems:
<ul>
<li>CalREDIE</li>
<li>CAIR2</li>
<li>Vital Records</li>
</ul></li>
<li>40+ functions</li>
<li>Includes Rmarkdown template for documenting R projects/analysis workflow</li>
<li>Very low dependencies, mostly written in base R</li>
<li>Extensive unit testing to ensure functions do what we want them to do</li>
</ul>
<p>Full documentation: <a href="https://ericmshearer.github.io/OCepi/" class="uri">https://ericmshearer.github.io/OCepi/</a></p>
<p>To install: <code>devtools::install_github("ericmshearer/OCepi")</code></p>
</section>
</div><div class="column" style="width:10%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:30%;">
<p><img src="hex_sticker.png" class="img-fluid"></p>
</div>
</div>
<section id="example-use-case" class="level3">
<h3 class="anchored" data-anchor-id="example-use-case">Example Use Case</h3>
<p>The following use case aims to demonstrate the different ways {OCepi} has streamlined how we go from raw data to data visualization.</p>
<p>To start, we’ll load simulated outbreak data included in the package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(OCepi)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dis_x <span class="ot">&lt;-</span> linelist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="pjapsuvwzd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#pjapsuvwzd table {
  font-family: Inter, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pjapsuvwzd thead, #pjapsuvwzd tbody, #pjapsuvwzd tfoot, #pjapsuvwzd tr, #pjapsuvwzd td, #pjapsuvwzd th {
  border-style: none;
}

#pjapsuvwzd p {
  margin: 0;
  padding: 0;
}

#pjapsuvwzd .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 14px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pjapsuvwzd .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pjapsuvwzd .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pjapsuvwzd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pjapsuvwzd .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pjapsuvwzd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjapsuvwzd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pjapsuvwzd .gt_col_heading {
  color: #FFFFFF;
  background-color: #231F20;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pjapsuvwzd .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #231F20;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pjapsuvwzd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pjapsuvwzd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pjapsuvwzd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pjapsuvwzd .gt_spanner_row {
  border-bottom-style: hidden;
}

#pjapsuvwzd .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pjapsuvwzd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pjapsuvwzd .gt_from_md > :first-child {
  margin-top: 0;
}

#pjapsuvwzd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pjapsuvwzd .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pjapsuvwzd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pjapsuvwzd .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pjapsuvwzd .gt_row_group_first td {
  border-top-width: 2px;
}

#pjapsuvwzd .gt_row_group_first th {
  border-top-width: 2px;
}

#pjapsuvwzd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjapsuvwzd .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pjapsuvwzd .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pjapsuvwzd .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjapsuvwzd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjapsuvwzd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pjapsuvwzd .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pjapsuvwzd .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pjapsuvwzd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjapsuvwzd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pjapsuvwzd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjapsuvwzd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pjapsuvwzd .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjapsuvwzd .gt_left {
  text-align: left;
}

#pjapsuvwzd .gt_center {
  text-align: center;
}

#pjapsuvwzd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pjapsuvwzd .gt_font_normal {
  font-weight: normal;
}

#pjapsuvwzd .gt_font_bold {
  font-weight: bold;
}

#pjapsuvwzd .gt_font_italic {
  font-style: italic;
}

#pjapsuvwzd .gt_super {
  font-size: 65%;
}

#pjapsuvwzd .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pjapsuvwzd .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pjapsuvwzd .gt_indent_1 {
  text-indent: 5px;
}

#pjapsuvwzd .gt_indent_2 {
  text-indent: 10px;
}

#pjapsuvwzd .gt_indent_3 {
  text-indent: 15px;
}

#pjapsuvwzd .gt_indent_4 {
  text-indent: 20px;
}

#pjapsuvwzd .gt_indent_5 {
  text-indent: 25px;
}

#pjapsuvwzd .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#pjapsuvwzd div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Ethnicity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Ethnicity</th>
<th id="Race" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Race</th>
<th id="Gender" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Gender</th>
<th id="Age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Age</th>
<th id="SexualOrientation" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">SexualOrientation</th>
<th id="SpecimenDate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">SpecimenDate</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Multiple Races</td>
<td class="gt_row gt_right" headers="Gender">M</td>
<td class="gt_row gt_right" headers="Age">46</td>
<td class="gt_row gt_right" headers="SexualOrientation">HET</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-07</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Unknown</td>
<td class="gt_row gt_right" headers="Race">Unknown</td>
<td class="gt_row gt_right" headers="Gender">M</td>
<td class="gt_row gt_right" headers="Age">4</td>
<td class="gt_row gt_right" headers="SexualOrientation">HET</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-09</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">White</td>
<td class="gt_row gt_right" headers="Gender">F</td>
<td class="gt_row gt_right" headers="Age">52</td>
<td class="gt_row gt_right" headers="SexualOrientation">UNK</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-07</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">White</td>
<td class="gt_row gt_right" headers="Gender">F</td>
<td class="gt_row gt_right" headers="Age">77</td>
<td class="gt_row gt_right" headers="SexualOrientation">UNK</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-11</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Unknown</td>
<td class="gt_row gt_right" headers="Race">American Indian or Alaska Native</td>
<td class="gt_row gt_right" headers="Gender">M</td>
<td class="gt_row gt_right" headers="Age">71</td>
<td class="gt_row gt_right" headers="SexualOrientation">HET</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-10</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Other</td>
<td class="gt_row gt_right" headers="Gender">M</td>
<td class="gt_row gt_right" headers="Age">70</td>
<td class="gt_row gt_right" headers="SexualOrientation">HET</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-09</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Black or African American</td>
<td class="gt_row gt_right" headers="Gender">F</td>
<td class="gt_row gt_right" headers="Age">11</td>
<td class="gt_row gt_right" headers="SexualOrientation">HET</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-08</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Black or African American</td>
<td class="gt_row gt_right" headers="Gender">F</td>
<td class="gt_row gt_right" headers="Age">8</td>
<td class="gt_row gt_right" headers="SexualOrientation">HET</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-12</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">American Indian or Alaska Native</td>
<td class="gt_row gt_right" headers="Gender">F</td>
<td class="gt_row gt_right" headers="Age">41</td>
<td class="gt_row gt_right" headers="SexualOrientation">HET</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-12</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Black or African American</td>
<td class="gt_row gt_right" headers="Gender">M</td>
<td class="gt_row gt_right" headers="Age">56</td>
<td class="gt_row gt_right" headers="SexualOrientation">HET</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="clean-up-the-data" class="level4">
<h4 class="anchored" data-anchor-id="clean-up-the-data">Clean up the data</h4>
<p>First things first: recode ethnicity and race to one variable, recode age to age groups, and recode gender and sexual orientation abbreviation to full names.</p>
<div class="narrow callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>All of our recoding functions aim to be compatible with CalREDIE, VRBIS, CAIR2, and BioSense/ESSENCE.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dis_x <span class="ot">&lt;-</span> dis_x <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_ethnicity =</span> <span class="fu">recode_race</span>(Ethnicity, Race, <span class="at">abbr_names =</span> <span class="cn">FALSE</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_groups =</span> <span class="fu">age_groups</span>(Age, <span class="at">type =</span> <span class="st">"covid"</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Gender =</span> <span class="fu">recode_gender</span>(Gender),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">SexualOrientation =</span> <span class="fu">recode_orientation</span>(SexualOrientation),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">week_ending =</span> <span class="fu">week_ending_date</span>(SpecimenDate)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="gpwairxsal" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#gpwairxsal table {
  font-family: Inter, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gpwairxsal thead, #gpwairxsal tbody, #gpwairxsal tfoot, #gpwairxsal tr, #gpwairxsal td, #gpwairxsal th {
  border-style: none;
}

#gpwairxsal p {
  margin: 0;
  padding: 0;
}

#gpwairxsal .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 14px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gpwairxsal .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gpwairxsal .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gpwairxsal .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gpwairxsal .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gpwairxsal .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gpwairxsal .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gpwairxsal .gt_col_heading {
  color: #FFFFFF;
  background-color: #231F20;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gpwairxsal .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #231F20;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gpwairxsal .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gpwairxsal .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gpwairxsal .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gpwairxsal .gt_spanner_row {
  border-bottom-style: hidden;
}

#gpwairxsal .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gpwairxsal .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gpwairxsal .gt_from_md > :first-child {
  margin-top: 0;
}

#gpwairxsal .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gpwairxsal .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gpwairxsal .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gpwairxsal .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gpwairxsal .gt_row_group_first td {
  border-top-width: 2px;
}

#gpwairxsal .gt_row_group_first th {
  border-top-width: 2px;
}

#gpwairxsal .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gpwairxsal .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gpwairxsal .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gpwairxsal .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gpwairxsal .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gpwairxsal .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gpwairxsal .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gpwairxsal .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gpwairxsal .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gpwairxsal .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gpwairxsal .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gpwairxsal .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gpwairxsal .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gpwairxsal .gt_left {
  text-align: left;
}

#gpwairxsal .gt_center {
  text-align: center;
}

#gpwairxsal .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gpwairxsal .gt_font_normal {
  font-weight: normal;
}

#gpwairxsal .gt_font_bold {
  font-weight: bold;
}

#gpwairxsal .gt_font_italic {
  font-style: italic;
}

#gpwairxsal .gt_super {
  font-size: 65%;
}

#gpwairxsal .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gpwairxsal .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gpwairxsal .gt_indent_1 {
  text-indent: 5px;
}

#gpwairxsal .gt_indent_2 {
  text-indent: 10px;
}

#gpwairxsal .gt_indent_3 {
  text-indent: 15px;
}

#gpwairxsal .gt_indent_4 {
  text-indent: 20px;
}

#gpwairxsal .gt_indent_5 {
  text-indent: 25px;
}

#gpwairxsal .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gpwairxsal div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Ethnicity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Ethnicity</th>
<th id="Race" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Race</th>
<th id="Gender" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Gender</th>
<th id="Age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Age</th>
<th id="SexualOrientation" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">SexualOrientation</th>
<th id="SpecimenDate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">SpecimenDate</th>
<th id="race_ethnicity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">race_ethnicity</th>
<th id="age_groups" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age_groups</th>
<th id="week_ending" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">week_ending</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Multiple Races</td>
<td class="gt_row gt_right" headers="Gender">Male</td>
<td class="gt_row gt_right" headers="Age">46</td>
<td class="gt_row gt_right" headers="SexualOrientation">Heterosexual or straight</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-07</td>
<td class="gt_row gt_right" headers="race_ethnicity">Multiple Races</td>
<td class="gt_row gt_right" headers="age_groups">45-54</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-11</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Unknown</td>
<td class="gt_row gt_right" headers="Race">Unknown</td>
<td class="gt_row gt_right" headers="Gender">Male</td>
<td class="gt_row gt_right" headers="Age">4</td>
<td class="gt_row gt_right" headers="SexualOrientation">Heterosexual or straight</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-09</td>
<td class="gt_row gt_right" headers="race_ethnicity">Unknown</td>
<td class="gt_row gt_right" headers="age_groups">0-17</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-11</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">White</td>
<td class="gt_row gt_right" headers="Gender">Female</td>
<td class="gt_row gt_right" headers="Age">52</td>
<td class="gt_row gt_right" headers="SexualOrientation">Missing/Unknown</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-07</td>
<td class="gt_row gt_right" headers="race_ethnicity">White</td>
<td class="gt_row gt_right" headers="age_groups">45-54</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-11</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">White</td>
<td class="gt_row gt_right" headers="Gender">Female</td>
<td class="gt_row gt_right" headers="Age">77</td>
<td class="gt_row gt_right" headers="SexualOrientation">Missing/Unknown</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-11</td>
<td class="gt_row gt_right" headers="race_ethnicity">White</td>
<td class="gt_row gt_right" headers="age_groups">75-84</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-11</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Unknown</td>
<td class="gt_row gt_right" headers="Race">American Indian or Alaska Native</td>
<td class="gt_row gt_right" headers="Gender">Male</td>
<td class="gt_row gt_right" headers="Age">71</td>
<td class="gt_row gt_right" headers="SexualOrientation">Heterosexual or straight</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-10</td>
<td class="gt_row gt_right" headers="race_ethnicity">American Indian/Alaska Native</td>
<td class="gt_row gt_right" headers="age_groups">65-74</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-11</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Other</td>
<td class="gt_row gt_right" headers="Gender">Male</td>
<td class="gt_row gt_right" headers="Age">70</td>
<td class="gt_row gt_right" headers="SexualOrientation">Heterosexual or straight</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-09</td>
<td class="gt_row gt_right" headers="race_ethnicity">Other</td>
<td class="gt_row gt_right" headers="age_groups">65-74</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-11</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Black or African American</td>
<td class="gt_row gt_right" headers="Gender">Female</td>
<td class="gt_row gt_right" headers="Age">11</td>
<td class="gt_row gt_right" headers="SexualOrientation">Heterosexual or straight</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-08</td>
<td class="gt_row gt_right" headers="race_ethnicity">Black/African American</td>
<td class="gt_row gt_right" headers="age_groups">0-17</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-11</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Black or African American</td>
<td class="gt_row gt_right" headers="Gender">Female</td>
<td class="gt_row gt_right" headers="Age">8</td>
<td class="gt_row gt_right" headers="SexualOrientation">Heterosexual or straight</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-12</td>
<td class="gt_row gt_right" headers="race_ethnicity">Black/African American</td>
<td class="gt_row gt_right" headers="age_groups">0-17</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-18</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Ethnicity">Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">American Indian or Alaska Native</td>
<td class="gt_row gt_right" headers="Gender">Female</td>
<td class="gt_row gt_right" headers="Age">41</td>
<td class="gt_row gt_right" headers="SexualOrientation">Heterosexual or straight</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-12</td>
<td class="gt_row gt_right" headers="race_ethnicity">Hispanic/Latinx</td>
<td class="gt_row gt_right" headers="age_groups">35-44</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-18</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Ethnicity">Non-Hispanic or Latino</td>
<td class="gt_row gt_right" headers="Race">Black or African American</td>
<td class="gt_row gt_right" headers="Gender">Male</td>
<td class="gt_row gt_right" headers="Age">56</td>
<td class="gt_row gt_right" headers="SexualOrientation">Heterosexual or straight</td>
<td class="gt_row gt_right" headers="SpecimenDate">2022-06-10</td>
<td class="gt_row gt_right" headers="race_ethnicity">Black/African American</td>
<td class="gt_row gt_right" headers="age_groups">55-64</td>
<td class="gt_row gt_right" headers="week_ending">2022-06-11</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>For <code>OCepi::age_groups(x, type = "decade")</code>, we combined our most common ways to bin age into one function via presets. Examples: Pertussis, West Nile Virus, decade, chronic Hepatitis C, flu vax. In <code>OCepi::recode_race(ethnicity, race)</code>, we provided the argument <code>abbr_names = FALSE</code> in case you want to shorten long names e.g.&nbsp;Native Hawaiian/Other Pacific Islander -&gt; NHOPI.</p>
<p>To achieve the same output without {OCepi}, you would need a long <code>dplyr::case_when()</code> statement for each variable. This example begins to demonstrate the ways our package simplifies and standardizes repetitive tasks.</p>
</section>
<section id="summarize-data" class="level4">
<h4 class="anchored" data-anchor-id="summarize-data">Summarize Data</h4>
<p>Next is to run some basic frequencies using <code>OCepi::add_percent(x, digits = 1, multiply = TRUE)</code> and create labels using <code>OCepi::n_percent(n, percent, reverse = TRUE, n_suppress = x)</code>. We have tried to incorporate as many ways to customize the output based on our experience: how many digits to round to, suppressing low values, multiplying a fraction by 100 or not, order for labels (n then % or % then n).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dis_x <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(race_ethnicity) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">add_percent</span>(n, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">n_percent</span>(n, percent, <span class="at">reverse =</span> <span class="cn">TRUE</span>, <span class="at">n_suppress =</span> <span class="dv">10</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apollo_table</span>(<span class="at">size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="cyvizzjmkr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#cyvizzjmkr table {
  font-family: Inter, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#cyvizzjmkr thead, #cyvizzjmkr tbody, #cyvizzjmkr tfoot, #cyvizzjmkr tr, #cyvizzjmkr td, #cyvizzjmkr th {
  border-style: none;
}

#cyvizzjmkr p {
  margin: 0;
  padding: 0;
}

#cyvizzjmkr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 14px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cyvizzjmkr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#cyvizzjmkr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cyvizzjmkr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cyvizzjmkr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cyvizzjmkr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cyvizzjmkr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cyvizzjmkr .gt_col_heading {
  color: #FFFFFF;
  background-color: #231F20;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cyvizzjmkr .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #231F20;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cyvizzjmkr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cyvizzjmkr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cyvizzjmkr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cyvizzjmkr .gt_spanner_row {
  border-bottom-style: hidden;
}

#cyvizzjmkr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#cyvizzjmkr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cyvizzjmkr .gt_from_md > :first-child {
  margin-top: 0;
}

#cyvizzjmkr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cyvizzjmkr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cyvizzjmkr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cyvizzjmkr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cyvizzjmkr .gt_row_group_first td {
  border-top-width: 2px;
}

#cyvizzjmkr .gt_row_group_first th {
  border-top-width: 2px;
}

#cyvizzjmkr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cyvizzjmkr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cyvizzjmkr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cyvizzjmkr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cyvizzjmkr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cyvizzjmkr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cyvizzjmkr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#cyvizzjmkr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cyvizzjmkr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cyvizzjmkr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cyvizzjmkr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cyvizzjmkr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cyvizzjmkr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cyvizzjmkr .gt_left {
  text-align: left;
}

#cyvizzjmkr .gt_center {
  text-align: center;
}

#cyvizzjmkr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cyvizzjmkr .gt_font_normal {
  font-weight: normal;
}

#cyvizzjmkr .gt_font_bold {
  font-weight: bold;
}

#cyvizzjmkr .gt_font_italic {
  font-style: italic;
}

#cyvizzjmkr .gt_super {
  font-size: 65%;
}

#cyvizzjmkr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#cyvizzjmkr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cyvizzjmkr .gt_indent_1 {
  text-indent: 5px;
}

#cyvizzjmkr .gt_indent_2 {
  text-indent: 10px;
}

#cyvizzjmkr .gt_indent_3 {
  text-indent: 15px;
}

#cyvizzjmkr .gt_indent_4 {
  text-indent: 20px;
}

#cyvizzjmkr .gt_indent_5 {
  text-indent: 25px;
}

#cyvizzjmkr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#cyvizzjmkr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="race_ethnicity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">race_ethnicity</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="percent" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percent</th>
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">label</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="race_ethnicity">American Indian/Alaska Native</td>
<td class="gt_row gt_right" headers="n">10</td>
<td class="gt_row gt_right" headers="percent">9.5</td>
<td class="gt_row gt_right" headers="label">9.5% (10)</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="race_ethnicity">Asian</td>
<td class="gt_row gt_right" headers="n">7</td>
<td class="gt_row gt_right" headers="percent">6.7</td>
<td class="gt_row gt_right" headers="label">**</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="race_ethnicity">Black/African American</td>
<td class="gt_row gt_right" headers="n">16</td>
<td class="gt_row gt_right" headers="percent">15.2</td>
<td class="gt_row gt_right" headers="label">15.2% (16)</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="race_ethnicity">Hispanic/Latinx</td>
<td class="gt_row gt_right" headers="n">19</td>
<td class="gt_row gt_right" headers="percent">18.1</td>
<td class="gt_row gt_right" headers="label">18.1% (19)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="race_ethnicity">Multiple Races</td>
<td class="gt_row gt_right" headers="n">6</td>
<td class="gt_row gt_right" headers="percent">5.7</td>
<td class="gt_row gt_right" headers="label">**</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="race_ethnicity">Native Hawaiian/Other Pacific Islander</td>
<td class="gt_row gt_right" headers="n">10</td>
<td class="gt_row gt_right" headers="percent">9.5</td>
<td class="gt_row gt_right" headers="label">9.5% (10)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="race_ethnicity">Other</td>
<td class="gt_row gt_right" headers="n">15</td>
<td class="gt_row gt_right" headers="percent">14.3</td>
<td class="gt_row gt_right" headers="label">14.3% (15)</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="race_ethnicity">Unknown</td>
<td class="gt_row gt_right" headers="n">8</td>
<td class="gt_row gt_right" headers="percent">7.6</td>
<td class="gt_row gt_right" headers="label">**</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="race_ethnicity">White</td>
<td class="gt_row gt_right" headers="n">14</td>
<td class="gt_row gt_right" headers="percent">13.3</td>
<td class="gt_row gt_right" headers="label">13.3% (14)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can do the same frequency table for age groups and see the groups are arranged in proper order (returned output is set to factor):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dis_x <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_groups) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">add_percent</span>(n, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">n_percent</span>(n, percent, <span class="at">reverse =</span> <span class="cn">TRUE</span>, <span class="at">n_suppress =</span> <span class="dv">10</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apollo_table</span>(<span class="at">size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="cehyxhdsto" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#cehyxhdsto table {
  font-family: Inter, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#cehyxhdsto thead, #cehyxhdsto tbody, #cehyxhdsto tfoot, #cehyxhdsto tr, #cehyxhdsto td, #cehyxhdsto th {
  border-style: none;
}

#cehyxhdsto p {
  margin: 0;
  padding: 0;
}

#cehyxhdsto .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 14px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cehyxhdsto .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#cehyxhdsto .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cehyxhdsto .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cehyxhdsto .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cehyxhdsto .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cehyxhdsto .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cehyxhdsto .gt_col_heading {
  color: #FFFFFF;
  background-color: #231F20;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cehyxhdsto .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #231F20;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cehyxhdsto .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cehyxhdsto .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cehyxhdsto .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cehyxhdsto .gt_spanner_row {
  border-bottom-style: hidden;
}

#cehyxhdsto .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#cehyxhdsto .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cehyxhdsto .gt_from_md > :first-child {
  margin-top: 0;
}

#cehyxhdsto .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cehyxhdsto .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cehyxhdsto .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cehyxhdsto .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cehyxhdsto .gt_row_group_first td {
  border-top-width: 2px;
}

#cehyxhdsto .gt_row_group_first th {
  border-top-width: 2px;
}

#cehyxhdsto .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cehyxhdsto .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cehyxhdsto .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cehyxhdsto .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cehyxhdsto .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cehyxhdsto .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cehyxhdsto .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#cehyxhdsto .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cehyxhdsto .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cehyxhdsto .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cehyxhdsto .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cehyxhdsto .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cehyxhdsto .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cehyxhdsto .gt_left {
  text-align: left;
}

#cehyxhdsto .gt_center {
  text-align: center;
}

#cehyxhdsto .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cehyxhdsto .gt_font_normal {
  font-weight: normal;
}

#cehyxhdsto .gt_font_bold {
  font-weight: bold;
}

#cehyxhdsto .gt_font_italic {
  font-style: italic;
}

#cehyxhdsto .gt_super {
  font-size: 65%;
}

#cehyxhdsto .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#cehyxhdsto .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cehyxhdsto .gt_indent_1 {
  text-indent: 5px;
}

#cehyxhdsto .gt_indent_2 {
  text-indent: 10px;
}

#cehyxhdsto .gt_indent_3 {
  text-indent: 15px;
}

#cehyxhdsto .gt_indent_4 {
  text-indent: 20px;
}

#cehyxhdsto .gt_indent_5 {
  text-indent: 25px;
}

#cehyxhdsto .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#cehyxhdsto div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="age_groups" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age_groups</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="percent" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percent</th>
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">label</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="age_groups">0-17</td>
<td class="gt_row gt_right" headers="n">22</td>
<td class="gt_row gt_right" headers="percent">21.0</td>
<td class="gt_row gt_right" headers="label">21% (22)</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="age_groups">18-24</td>
<td class="gt_row gt_right" headers="n">7</td>
<td class="gt_row gt_right" headers="percent">6.7</td>
<td class="gt_row gt_right" headers="label">**</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="age_groups">25-34</td>
<td class="gt_row gt_right" headers="n">12</td>
<td class="gt_row gt_right" headers="percent">11.4</td>
<td class="gt_row gt_right" headers="label">11.4% (12)</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="age_groups">35-44</td>
<td class="gt_row gt_right" headers="n">12</td>
<td class="gt_row gt_right" headers="percent">11.4</td>
<td class="gt_row gt_right" headers="label">11.4% (12)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="age_groups">45-54</td>
<td class="gt_row gt_right" headers="n">10</td>
<td class="gt_row gt_right" headers="percent">9.5</td>
<td class="gt_row gt_right" headers="label">9.5% (10)</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="age_groups">55-64</td>
<td class="gt_row gt_right" headers="n">13</td>
<td class="gt_row gt_right" headers="percent">12.4</td>
<td class="gt_row gt_right" headers="label">12.4% (13)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="age_groups">65-74</td>
<td class="gt_row gt_right" headers="n">10</td>
<td class="gt_row gt_right" headers="percent">9.5</td>
<td class="gt_row gt_right" headers="label">9.5% (10)</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="age_groups">75-84</td>
<td class="gt_row gt_right" headers="n">13</td>
<td class="gt_row gt_right" headers="percent">12.4</td>
<td class="gt_row gt_right" headers="label">12.4% (13)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="age_groups">85+</td>
<td class="gt_row gt_right" headers="n">6</td>
<td class="gt_row gt_right" headers="percent">5.7</td>
<td class="gt_row gt_right" headers="label">**</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Calling <code>OCepi::add_percent()</code> is much simpler than <code>round(n / sum(n) * 100, digits = 1)</code>, or <code>OCepi::n_percent()</code> versus <code>sprintf("%s (%s%%), n, percent)</code>. Not only are the {OCepi} functions simpler, you gain tons of flexibility in how you want your summarized data to look.</p>
<p>We also have the ability to calculate incidence rates using <code>OCepi::rate_per_100k(n, pop_denom, digits = 1)</code> or time between dates using <code>OCepi::time_between(recent_date, older_date, unit = c("days"))</code>.</p>
</section>
<section id="data-visualizations" class="level4">
<h4 class="anchored" data-anchor-id="data-visualizations">Data Visualizations</h4>
<p>Now that we have summarized data, we can build our data visualizations. To achieve unified aesthetics across our four surveillance branches, we developed <code>theme_apollo(direction = x)</code> and <code>apollo_label()</code>. Our theme is designed to work vertical/horizontal orientations as well as maps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dis_x <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(race_ethnicity) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">add_percent</span>(n, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">n_percent</span>(n, percent, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> race_ethnicity, <span class="at">y =</span> percent)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_apollo</span>() <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apollo_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Disease X Cases by Race/Ethnicity, 2024"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PHS/Communicable Disease Control"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Race/Ethnicity"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion (%)"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/re_plot_1-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Overall this looks much nicer than {ggplot2} right out of the box, but we can further improve by wrapping the long labels using <code>OCepi::wrap_labels()</code> and filling the bars with <code>OCepi::cdcd_color()</code>. Our version of label wrapping will break/wrap the text at the forward slash. This may not always produce the desired outcome, so we recommend trying <code>scales::label_wrap(15)</code> or flipping to horizontal via <code>coord_flip()</code> as another approach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dis_x <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(race_ethnicity) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">add_percent</span>(n, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">n_percent</span>(n, percent, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>(race_ethnicity), <span class="at">y =</span> percent)) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="fu">cdcd_color</span>(<span class="st">"dodgers"</span>)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">wrap_labels</span>()) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_apollo</span>(<span class="at">direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apollo_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Disease X Cases by Race/Ethnicity, 2024"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PHS/Communicable Disease Control"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Race/Ethnicity"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion (%)"</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/re_plot_2-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="extending-ggplot2" class="level4">
<h4 class="anchored" data-anchor-id="extending-ggplot2">Extending ggplot2</h4>
<p>There are other ways {OCepi} can help elevate data visualizations, specifically around highlighting groups of interest. It may not be obvious in the plot above which group makes up the greatest proportion of cases. {OCepi} offers two solutions: <code>OCepi::highlight_geom()</code> and <code>OCepi::desaturate_geom()</code>. One version highlights your important group and fades the rest to light grey, the other highlights the important group and desaturates the rest. At their core, these functions use <code>dplyr::filter()</code> to achieve the desired effect. Examples: <code>percent == max(percent)</code>, <code>n &gt; 50</code>, or <code>gender %in% c("Female")</code>.</p>
<p>In the following example, the group(s) making up the highest proportion of cases for that variable will be highlighted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>re_tbl <span class="ot">&lt;-</span> dis_x <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(race_ethnicity) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">add_percent</span>(n, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">n_percent</span>(n, percent, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> re_tbl, <span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>(race_ethnicity), <span class="at">y =</span> percent)) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">highlight_geom</span>(percent <span class="sc">==</span> <span class="fu">max</span>(percent), <span class="at">pal =</span> <span class="fu">cdcd_color</span>(<span class="st">"london pink"</span>)) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">wrap_labels</span>()) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_apollo</span>(<span class="at">direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apollo_label</span>(<span class="at">data =</span> re_tbl, <span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Disease X Cases by Race/Ethnicity, 2024"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PHS/Communicable Disease Control"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Race/Ethnicity"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion (%)"</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/re_plot_3-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>If you prefer desaturate, you can control the amount of desaturation to get the desired output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>re_tbl <span class="ot">&lt;-</span> dis_x <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(race_ethnicity) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">add_percent</span>(n, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">n_percent</span>(n, percent, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> re_tbl, <span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>(race_ethnicity), <span class="at">y =</span> percent)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">desaturate_geom</span>(percent <span class="sc">==</span> <span class="fu">max</span>(percent), <span class="at">pal =</span> <span class="fu">cdcd_color</span>(<span class="st">"dodgers"</span>), <span class="at">desaturate =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">wrap_labels</span>()) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_apollo</span>(<span class="at">direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apollo_label</span>(<span class="at">data =</span> re_tbl, <span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Disease X Cases by Race/Ethnicity, 2024"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PHS/Communicable Disease Control"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Race/Ethnicity"</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion (%)"</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/re_plot_4-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>We also designed the functions to work with <code>facet_grid()</code> and <code>facet_wrap()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>facet_tbl <span class="ot">&lt;-</span> dis_x <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Gender <span class="sc">!=</span> <span class="st">"Missing/Unknown"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Gender, age_groups) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender) <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">add_percent</span>(n, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">n_percent</span>(n, percent, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> facet_tbl, <span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>(age_groups), <span class="at">y =</span> percent)) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>Gender) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">desaturate_geom</span>(percent <span class="sc">==</span> <span class="fu">max</span>(percent), <span class="at">pal =</span> <span class="fu">cdcd_color</span>(<span class="st">"plum"</span>), <span class="at">desaturate =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">wrap_labels</span>()) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">32</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_apollo</span>(<span class="at">direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apollo_label</span>(<span class="at">data =</span> facet_tbl, <span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Disease X Cases by Gender and Age Group, 2024"</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PHS/Communicable Disease Control"</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Groups (Year)"</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion (%)"</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/re_plot_5-1.png" class="img-fluid figure-img" width="1536"></p>
</figure>
</div>
</div>
</div>
<p>You can also split the data using <code>facet_wrap()</code> and <code>facet_grid()</code>.</p>
<p><strong>Other examples of highlight/desaturate_geom():</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-overflow-wrap code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>zip_map <span class="ot">&lt;-</span> oc_zip_sf</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>zip_map<span class="sc">$</span>n_cases <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>, <span class="dv">86</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#desaturate - map</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> zip_map) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">desaturate_geom</span>(n_cases <span class="sc">&gt;</span> <span class="dv">80</span>, <span class="at">pal =</span> <span class="fu">cdcd_color</span>(<span class="st">"dodgers"</span>), <span class="at">desaturate =</span> <span class="fl">0.8</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> zip_map, <span class="fu">aes</span>(<span class="at">label =</span> Zip)) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_apollo</span>(<span class="at">direction =</span> <span class="st">"map"</span>) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Disease X Cases by Zip Code"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PHS/Communicable Disease Control"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"*Note: zip codes with &gt;80 cases are highlighted."</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/disease-map-1.png" class="img-fluid figure-img" width="1536"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-overflow-wrap code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://data.chhs.ca.gov/dataset/f333528b-4d38-4814-bebb-12db1f10f535/resource/046cdd2b-31e5-4d34-9ed3-b48cdbc4be7a/download/covid19cases_test.csv"</span>, <span class="at">na =</span> <span class="st">""</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> covid <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate =</span> <span class="fu">rate_per_100k</span>(cases, population, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(area) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_ma_7 =</span> zoo<span class="sc">::</span><span class="fu">rollmean</span>(rate, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="dv">0</span>, <span class="at">align =</span> <span class="st">"right"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Orange"</span>,<span class="st">"Los Angeles"</span>,<span class="st">"San Diego"</span>))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>covid_first_wave <span class="ot">&lt;-</span> <span class="fu">filter</span>(covid, date <span class="sc">&gt;=</span> <span class="st">"2020-10-01"</span>, date <span class="sc">&lt;=</span> <span class="st">"2021-01-05"</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> covid_first_wave, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> rate_ma_7, <span class="at">color =</span> area)) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apollo_label</span>(<span class="at">data =</span> <span class="fu">end_points</span>(covid_first_wave, <span class="at">date =</span> date), <span class="fu">aes</span>(<span class="at">label =</span> area, <span class="at">color =</span> area), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">highlight_geom</span>(area <span class="sc">==</span> <span class="st">"Orange"</span>, <span class="at">pal =</span> <span class="fu">cdcd_color</span>(<span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%m/%y"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>))) <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">100</span>,<span class="dv">125</span>,<span class="dv">150</span>)) <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_apollo</span>(<span class="at">legend =</span> <span class="st">"Hide"</span>) <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"COVID-19 Incidence Rates by SoCal County"</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PHS/Communicable Disease Control"</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rate per 100,000"</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"LHJ"</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/covid-highlight-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="honorable-mentions" class="level3">
<h3 class="anchored" data-anchor-id="honorable-mentions">Honorable Mentions</h3>
<section id="end_points" class="level4">
<h4 class="anchored" data-anchor-id="end_points">end_points()</h4>
<p>Direct labeling is often very helpful, particularly line graphs with &gt;1 group. To achieve this, we designed <code>OCepi::end_points(df, date = x, group_by = y)</code>. If your groups all end at the same end point, you can ignore <code>group_by</code>. When groups end at different time points, use <code>group_by</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-overflow-wrap code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> covid_first_wave, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> rate_ma_7, <span class="at">color =</span> area)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%m/%y"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>))) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">100</span>,<span class="dv">125</span>,<span class="dv">150</span>)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">end_points</span>(covid_first_wave, <span class="at">date =</span> date), <span class="fu">aes</span>(<span class="at">label =</span> area, <span class="at">color =</span> area), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">4.5</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_apollo</span>(<span class="at">legend =</span> <span class="st">"Hide"</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"COVID-19 Incidence Rates by SoCal County"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PHS/Communicable Disease Control"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rate per 100,000"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"LHJ"</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">cdcd_color</span>(<span class="st">"mustard"</span>,<span class="st">"light blue"</span>,<span class="st">"title color"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/end_points-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="posneg" class="level4">
<h4 class="anchored" data-anchor-id="posneg">pos()/neg()</h4>
<p>We have begun to condense all the variants of “positive” and “negative” from ELR data into <code>OCepi::pos()</code>/<code>OCepi::neg()</code>. Both functions contain SNOMED and string patterns. Please note: casing is set to upper case - adjust your dataset accordingly.</p>
<p><code>collapse</code> controls whether to keep output as vector or collapse into one long string separated by “|”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pos</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "POSITIVE"         "REACTIVE"         "DETECTED"         "10828004"        
 [5] "260373001"        "840533007"        "PCRP11"           "PDETD"           
 [9] "COVPRE"           "11214006"         "Positive for IgG" "POS"             
[13] "DECTECTED"        "REA"              "PPOSI"            "REAC"            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pos</span>(<span class="at">collapse =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "POSITIVE|REACTIVE|DETECTED|10828004|260373001|840533007|PCRP11|PDETD|COVPRE|11214006|Positive for IgG|POS|DECTECTED|REA|PPOSI|REAC"</code></pre>
</div>
</div>
<p>Now used within <code>dplyr::case_when</code> statement:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>elr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Results =</span> <span class="fu">c</span>(<span class="st">"POSITIVE"</span>,<span class="st">"DETECTED"</span>,<span class="st">"POS"</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>elr <span class="ot">&lt;-</span> elr <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#use case 1</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_results =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      Results <span class="sc">%in%</span> <span class="fu">pos</span>(<span class="at">collapse =</span> <span class="cn">FALSE</span>) <span class="sc">~</span> <span class="st">"Positive"</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#use case 2</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_results2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="fu">pos</span>(<span class="at">collapse =</span> <span class="cn">TRUE</span>), Results, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Positive"</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(elr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Results test_results test_results2
1 POSITIVE     Positive      Positive
2 DETECTED     Positive      Positive
3      POS     Positive      Positive</code></pre>
</div>
</div>
<p>As we find more use cases, we will add new ways “positive” and “negative” show up in the data. Another idea is to add an argument to add results on the fly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#this is just an idea, not live yet#</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pos</span>(<span class="at">collapse =</span> <span class="cn">FALSE</span>, <span class="at">add_in =</span> <span class="fu">c</span>(<span class="st">"POSITIVE!!!"</span>,<span class="st">"MOREPOSITIVE"</span>,<span class="st">"POSITIVEPOSITIVE"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vrbis_" class="level4">
<h4 class="anchored" data-anchor-id="vrbis_">vrbis_*()</h4>
<p>Clean up single letter abbreviations and mark deaths that belong to OC, which are defined as 1) LTCF resident in Orange County or 2) non-LTCF resident and has info indicating OC residency. This function is very specific to Orange County but can be adopted for any LHJ with slight modifications.</p>
<p>Variables Needed:</p>
<ul>
<li>Place of Death (Facility)</li>
<li>County of Death (Code)</li>
<li>Decedents County of Residence (NCHS Code)</li>
</ul>
<p>Constants Needed:</p>
<ul>
<li>fips</li>
<li>county_code (per VRBIS data dictionary)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-overflow-wrap code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>deaths <span class="ot">&lt;-</span> deaths <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">death_location =</span> <span class="fu">vrbis_place_death</span>(death_location),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">manner_of_death =</span> <span class="fu">vrbis_manner_death</span>(manner_of_death),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">oc_resident =</span> <span class="fu">vrbis_resident</span>(death_location, county_of_death_code, county_code, <span class="at">fips =</span> <span class="st">"059"</span>, <span class="at">county_code =</span> <span class="st">"30"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(oc_resident <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#patient 1 - OC SNF resident</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vrbis_resident</span>(<span class="st">"6"</span>, <span class="st">"30"</span>, <span class="st">"059"</span>, <span class="at">fips =</span> <span class="st">"059"</span>, <span class="at">county_code =</span> <span class="st">"30"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#patient 2 - OC Community Death</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vrbis_resident</span>(<span class="st">"1"</span>, <span class="st">"30"</span>, <span class="st">"059"</span>, <span class="at">fips =</span> <span class="st">"059"</span>, <span class="at">county_code =</span> <span class="st">"30"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#patient 3 - Santa Cruz resident dies in OC facility</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vrbis_resident</span>(<span class="st">"1"</span>, <span class="st">"30"</span>, <span class="st">"087"</span>, <span class="at">fips =</span> <span class="st">"059"</span>, <span class="at">county_code =</span> <span class="st">"30"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="match_id_" class="level4">
<h4 class="anchored" data-anchor-id="match_id_">match_id_*</h4>
<p>When two datasets have no matching primary key, <code>OCepi::match_id_*()</code> creates a primary key to join on. Probabilistic matching is excellent but computationally intensive (especially at scale with a so-so tech stack). When the id’s are made, all of the string is capitalized. Depending on how messy your address and phone number variables are, you may want to clean them up using <code>OCepi::clean_address(x, keep_extra = TRUE)</code> or <code>OCepi::clean_phone()</code>. At it’s core, the id consists of: first four letters of first/last name and date of birth.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variant 1 - uses first 10 characters of address</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">match_id_1</span>(<span class="st">"Mickey"</span>,<span class="st">"Mouse"</span>,<span class="st">"1955-07-17"</span>,<span class="st">"1313 Disneyland Dr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MICKMOUS1955-07-171313 Disne"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variant 1 - standardizing address</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">match_id_1</span>(<span class="st">"Mickey"</span>,<span class="st">"Mouse"</span>,<span class="st">"1955-07-17"</span>,<span class="fu">clean_address</span>(<span class="st">"1313 Disneyland Dr"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MICKMOUS1955-07-171313 Disne"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variant 2 - uses full address</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">match_id_2</span>(<span class="st">"Mickey"</span>,<span class="st">"Mouse"</span>,<span class="st">"1955-07-17"</span>,<span class="st">"1313 Disneyland Dr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MICKMOUS1955-07-171313 Disneyland Dr"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variant 2 - standardizing address</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">match_id_2</span>(<span class="st">"Mickey"</span>,<span class="st">"Mouse"</span>,<span class="st">"1955-07-17"</span>,<span class="fu">clean_address</span>(<span class="st">"1313 Disneyland Dr"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MICKMOUS1955-07-171313 Disneyland Drive"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variant 3</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">match_id_3</span>(<span class="st">"Mickey"</span>,<span class="st">"Mouse"</span>,<span class="st">"1955-07-17"</span>,<span class="st">"714-781-4636"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MICKMOUS1955-07-17714-781-4636"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variant 3 - standardizing phone number</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">match_id_3</span>(<span class="st">"Mickey"</span>,<span class="st">"Mouse"</span>,<span class="st">"1955-07-17"</span>,<span class="fu">clean_phone</span>(<span class="st">"714-781-4636"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MICKMOUS1955-07-177147814636"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variant 4</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">match_id_4</span>(<span class="st">"Mickey"</span>,<span class="st">"Mouse"</span>,<span class="st">"1955-07-17"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MICKMOUS1955-07-17"</code></pre>
</div>
</div>
<p>After merging on primary key, we recommend assessing the quality of the match and comparing using the other id methods.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>udf <span class="ot">&lt;-</span> udf <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">match_key =</span> <span class="fu">match_id_1</span>(FirstName, LastName, DOB, Address)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>vrbis <span class="ot">&lt;-</span> vrbis <span class="sc">|&gt;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">match_key =</span> <span class="fu">match_id_1</span>(FirstName, LastName, DOB, Address)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">left_join</span>(udf, vrbis, <span class="at">by =</span> <span class="st">"match_key"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>